import"./main.BrJ856Ss.js";import"./main.CyP-aRTt.js";import"./main.s9DANdgV.js";import{_ as Y,s as Z,a as $,r as ee,o as ae,aQ as te,k as oe,ba as se,V as E,bb as re,bc as ne,n as ie,bd as le,be as ce,bf as ue}from"./eo-dash.CfFp3r0p.js";import{c as pe,j as de,P as ve}from"./ProcessList-Cm5p1ZJX.tlFqA9-R.js";import{o as F,i as _,h as fe}from"./handling-CdHAvwJ9.Cgh133h4.js";import{d as me,m as ye}from"./async-bBeUGZpM.CajCGb4Z.js";import{p as d,a2 as P,h as C,q as L,c as B,o as y,G as he,e as w,j as be,k as h,N as ge,aw as H,b as M,w as S,a as q,v as z,P as xe}from"./framework.DcHDDd1r.js";import"./lit-element.C0HUAAc_.js";import"./addCommonStyleSheet.B9YrlOoW.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.CBzmZSrJ.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Br7Jz3X5.js";import"./extent.CajDHjk1.js";import"./WKT.CRW3-4HE.js";import"./browser.CQpScIU-.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./index.DCVKSTf4.js";import"./item.Bx-rtsOD.js";import"./index-xCTFvYXt.BlX7bQcq.js";import"./VTooltip-DAbtbaZN.dVcOyP0A.js";import"./forwardRefs-BVDdebYN.DnMahizm.js";import"./transition-psZapV6I.D_6UYQOL.js";const Ce=({selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o,mapElement:a})=>{const m=ne(le);z(async()=>{((a==null?void 0:a.layers.length)??0)>1?await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o}):m.once(async()=>{await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,loading:u,processResults:s,isPolling:o})})});const b=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";ie(async(g,f)=>{g===b&&await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o})})};function we(r,n,c,l){const i=async o=>{await l()},s=async()=>{await xe(()=>{var o;(o=n.value)==null||o.addEventListener("change",i)})},u=()=>{var o;(o=n.value)==null||o.removeEventListener("change",i)};L(c,o=>{var a;r.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),z(()=>{L(r,async o=>{o?await s():u()},{immediate:!0})})}const ke="eox-chart{--background-color: transparent;padding-top:1em}eox-jsonform{padding:.7em;min-height:0px}",_e={ref:"container",class:"pb-4"},Pe=[".schema"],Be=[".spec",".dataValues",".opt"],Le={class:"mt-4 text-right"},Te={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(r){const n=d(null),c=d(null),l=d(!1),i=d(null),s=P("jsonformEl"),u=P("chartElRef"),o=C(()=>{var t;return(t=T.value)==null?void 0:t.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),a=P("container"),m=d(!1),b=d(!1),g=d(!1),f=d([]),G=C(()=>!b.value&&(!!i.value||!!n.value)&&!!s.value),{selectedStac:T,selectedCompareStac:Q}=Z($()),k=r.enableCompare?Q:T,x=r.enableCompare?ee:ae,j=r.enableCompare?te:oe,V=r.enableCompare?pe:de,U=C(()=>{var t;return j.value+((t=x.value)==null?void 0:t.id)});Ce({selectedStac:k,mapElement:x.value,jsonformEl:s,jsonformSchema:i,chartSpec:n,isProcessed:l,processResults:f,loading:m,isPolling:g});const W=()=>{f.value.forEach(t=>{var p;if(!t)return;let e="";typeof t=="string"?(e=t.includes("/")?t.split("/").pop()??"":t,e=e.includes("?")?e.split("?")[0]:e):e=((p=k.value)==null?void 0:p.id)+"_process_results.json",ye(e,t)})},N=async()=>{var O,R,A;const e=(D=>{var I,J;for(const K in D.properties)if((J=(I=D.properties[K])==null?void 0:I.options)!=null&&J.drawtools)return K})(i.value);if(e&&Array.isArray((O=s.value)==null?void 0:O.value[e])&&!((R=s.value)!=null&&R.value[e].length)){l.value=!1,n.value=null;return}const v=(A=s.value)==null?void 0:A.editor.validate();if(v!=null&&v.length){console.warn("[eodash] Form validation failed",v);return}f.value=[],await fe({jobs:V,selectedStac:k,jsonformEl:s,jsonformSchema:i,chartSpec:n,chartData:c,loading:m,isPolling:g,processResults:f,mapElement:x.value}),l.value=!0,o.value&&me(V,j.value)};we(b,s,i,N);const X=C(()=>{var e,p,v;const t={};return(e=n.value)!=null&&e.height||(t.height=Math.max((((p=a.value)==null?void 0:p.offsetHeight)??0)-(((v=s.value)==null?void 0:v.offsetHeight)??0),200)+"px"),t});return L(u,t=>{r.enableCompare?ce.value=t:ue.value=t}),(t,e)=>(y(),B("div",_e,[he(ve,{"map-element":h(x),"enable-compare":r.enableCompare},null,8,["map-element","enable-compare"]),i.value?(y(),B("eox-jsonform",{key:U.value,ref_key:"jsonformEl",ref:s,".schema":i.value},null,40,Pe)):w("v-if",!0),l.value&&n.value?(y(),B("eox-chart",{key:1,ref_key:"chartElRef",ref:u,class:"chart",".spec":H(n.value),".dataValues":H(c.value),"onClick:item":e[0]||(e[0]=(...p)=>h(F)&&h(F)(...p)),style:ge(X.value),".opt":r.vegaEmbedOptions},null,44,Be)):w("v-if",!0),be("div",Le,[G.value?(y(),M(E,{key:0,loading:m.value,style:{"margin-right":"20px"},"append-icon":[h(se)],onClick:N,color:"primary"},{default:S(()=>[...e[1]||(e[1]=[q(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):w("v-if",!0),f.value.length&&l.value&&!o.value?(y(),M(E,{key:1,color:"primary","append-icon":[h(re)],onClick:W},{default:S(()=>[...e[2]||(e[2]=[q(" Download ",-1)])]),_:1},8,["append-icon"])):w("v-if",!0)])],512))}},ra=Y(Te,[["styles",[ke]]]);export{ra as default};
